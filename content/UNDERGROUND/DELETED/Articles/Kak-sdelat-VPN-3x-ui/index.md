---
type: docs
title: ➡️ Как сделать VPN - 3x-ui
# description: "IDK"
# weight: 900
bookCollapseSection: false
bookFlatSection: false
bookToc: true
bookComments: false
bookSearchExclude: true
bookHidden: false
---

# Как сделать VPN - 3x-ui

![](pochuvstvui-siebia-kitaitsiem-cover.jpg)

{{< hint warning >}}
**Внимание!**<br>
**Автор статьи никого и ни к чему не призывает!
Эта статья написана в образовательных целях с толикой юмора.
Не воспринимайте написанное здесь всерьез и не повторяйте за автором.**
{{< /hint >}}

{{< hint info >}}
**Это сокращенная версия.**
{{< /hint >}}

## Установка

Подключаемся к серверу по [ssh](https://ru.wikipedia.org/wiki/SSH?nt). Вы должны быть рутом ([root](https://timeweb.com/ru/community/articles/root-v-linux?nt)), тобишь админом.

{{< hint info >}}
Скриншоты терминала были сделаны на Debian. Потому что у меня эта система уже была установлена. Вы все можете делать на Ubuntu.
{{< /hint >}}

{{< hint info >}}
Когда спрашивает да или нет (y/n) - вводим "y" и нажимаем Enter.
{{< /hint >}}

Пишем в терминал следующее:

```bash
apt update && apt upgrade    # Необязательно
                             # ИЛИ
apt update                   # Обязательно
```

Возможно потребуется обновить пакеты до последних версий, тогда нужно вводить первую команду. Что я и рекомендую, ничего страшного не случится, просто придется подождать. А вот вторая команда обновляет список доступных пакетов из официальных репозиториев.

{{< imgs/imgc width="" caption="Команды apt update \ apt upgrade (Debian)" alt="" src="001-komandy-apt-update-apt-upgrade.jpg" >}}

Далее:

```bash
apt install curl # Установит утилиту curl
```

Далее скачиваем скрипт и запускаем его, он установит все необходимое, а так же саму панель управления впн'ами:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)
```

## Конец установки

После установки скрипт запросит некоторые данные:

- Username
- Password
- Port

В <mark>username</mark>, <mark>password</mark> и <mark>port</mark> вводите что то, что не забудете через 5 минут. В <mark>port</mark> нужно ввести что то от 2000 до 65000.

Username, Password, Port потом если что можно будет поменять в "Настройки панели" > "Настройки панели" \ "Настройки безопасности".

Так же в новых версиях панели, оно просит ввести путь панели, либо вводите его сразу, либо просто оставляете пустым. В главе "[Безопасность](#безопасность)", мы его все равно установим.

## Создаем профиль

Переходим по http://`ip`:`port`/. Где ip - ip вашего сервера. Где port - порт который вы вводили ранее. Вводите логин и пароль. *Логин это username.*

Заходим на вкладку "Подключения", нажимаем "Добавить подключение":

```
# Что не указано ниже - не трогать.

Примечание               : Вводим что то
Протокол                 : vless
Порт                     : от 2000 до 65000, но не порт вашей панели

Протокол передачи        : TCP
Reality                  : Включить
uTLS                     : Любой. Но лучше Chrome \\ Firefox
Dest                     : Домен:порт сайта который будет маскировкой
Server Names             : Аналогично "Dest"

# При заполнении Dest и Server Names соотвествуйте шаблону

Sniffing                 : Включить
HTTP, TLS, QUIC, FAKEDNS : Включить
```

{{< imgs/imgc width="" caption="Конфигурация профиля (VLESS xtls-reality)" alt="" src="002-konfiguratsiya-podklyucheniya.jpg" >}}

_В конфиге есть домен ("Домен: ..."), он там есть потому что он есть, но он не обязателен._

Далее нажимаем "Get New Key" и "Создать".

## Подключаемся

Для подключения к вашему новому впн'у понадобится приложение. Есть приложение с открытым исходным кодом [Nekoray](https://github.com/MatsuriDayo/nekoray?nt) aka [NekoBox](https://github.com/MatsuriDayo/nekoray?nt) и я вам его рекомендую. Переходим [сюда](https://matsuridayo.github.io/?nt) и выбираем платформу.

- Качаем NekoBox [для ПК](https://github.com/MatsuriDayo/nekoray/releases?nt)
- Качаем NekoBox [для андроид](https://github.com/MatsuriDayo/NekoBoxForAndroid/releases?nt)

{{< hint info >}}
Важно качать с github, тк версии в Google Play устаревшие и редко обновляются.
{{< /hint >}}

Скачали, установили.

Переходим обратно в панель. Нажимаем на "+" > Тыкаем на значок "QR-код". Откроется окно, там тыкаем уже на сам QR-код и ключ скопируется в буфер.

{{< imgs/imgc caption="Подключение к серверу (Панель)" src="003-kak-podklyuchitsya-k-serveru-panel.jpg" >}}

### На ПК

Желательно открывать приложение от имени администратора.

Server > Add profile from clipboard.

{{< imgs/imgc caption="Добавление сервера в NekoBox (ПК)" src="004-podklyucheniye-k-vpn-nekoray-pc-1.jpg" >}}

Сервер должен был появится в списке, далее нажимаем по нему ПКМ > "Start".

{{< imgs/imgc caption="Запуск сервера в NekoBox (ПК)" src="005-podklyucheniye-k-vpn-nekoray-pc-2.jpg" >}}

Должна была появится галочка напротив сервера слева, вместо цифры его позиции. Далее ставим галочки "System Proxy" и "Tun Mode".

{{< hint info >}}
Да, включить можно и то и другое одновременно.
{{< /hint >}}

Tun Mode - это впн мод. Режим прокси будет работать везде где прокси поддерживаются, режим впн будет работать на всей системе.

{{< imgs/imgc caption="System Proxy \ Tun Mode \ NekoBox (ПК)" src="006-podklyucheniye-k-vpn-nekoray-pc-3.jpg" >}}

Прокси будет работать немного быстрее режима впн. Поэтому если вы собирайтесь использовать впн только в браузере и у вас популярный браузер, который поддерживает прокси, то режим впн можно не включать.

Так же, желательно, но не обязательно перейти в "Preferences" > "Tun Settings", и поставить галочки на "Strict Route" и "FakeDNS".

Что бы отключиться, выключите режим впн и прокси, после нажмите ПКМ по серверу > "Stop".

### На андроид

И так вы скачали NekoBox. Как то передаете себе ключ, или заходите в панель с телефона. Копируете.

Нажимаем сверху справа на "файлик с плюсом" > "Импорт из буфера обмена".

Для подключения к серверу, нажимаем на сервер и кнопку внизу.

{{< imgs/imgc caption="Добавление \ Подключение к серверу в NekoBox (Андроид)" src="007-dobavleniye-servera-i-podklyucheniye-s-android-nekobox.jpg" >}}

Так же как и на ПК рекомендую зайти в настройки и включить "FakeDNS".

### А как же iOS?

Я не айфон юзер поэтому ничего сказать не могу. Как настраивать, и что.

Но на просторах магазина яблок было найдено приложение под названием "[FoXray](https://apps.apple.com/us/app/foxray/id6448898396?nt)".

## Безопасность

{{< hint info >}}
**Это не обязательно, но крайне желательно.**
{{< /hint >}}

Вам понадобится:

- Домен
- Аккаунт на [Cloudflare](https://www.cloudflare.com/?nt)
- **Умение читать и внимательность**

Для начала нужно привязать IP адрес сервера к домену, после привязки перейти по domain:port, порт который указывался в конфигурации панели. Если все открылось, все окей.

Далее на сервере ввести команду:

```bash
x-ui
```

И выбрать из списка "**Cloudflare SSL**".

Панель просит указать нужные данные: домен, API ключ, email адрес.

Домен указываем, тот самый который привязывали к серверу.

API ключ можно получить [здесь](https://dash.cloudflare.com/profile/api-tokens?nt)

Профиль > Мой профиль > API Tokens.

Нам нужен "**Global API Key**". Копируем ключ, вставляем в терминал.

Далее вводим email адрес на который зарегистрирован аккаунт Cloudflare.

И ждем, иногда долго ждем. Но в среднем минуту. Вы должны получить вывод типо этого:

```bash
[**** CEST] Your cert is in: /root/.acme.sh/<yourDomain>_ecc/<yourDomain>.cer
[**** CEST] Your cert key is in: /root/.acme.sh/<yourDomain>_ecc/<yourDomain>.key
[**** CEST] The intermediate CA cert is in: /root/.acme.sh/<yourDomain>_ecc/ca.cer
[**** CEST] And the full chain certs is there: /root/.acme.sh/<yourDomain>_ecc/fullchain.cer
```

Сначала копируем строку `/root/.acme.sh/<yourDomain>_ecc/fullchain.cer`, и вставляем ее в панели:

- Настройки панели >
- "**Путь к файлу публичного ключа сертификата панели**"

Далее копируем строку `/root/.acme.sh/<yourDomain>_ecc/<yourDomain>.key`, и вставляем ее там же в "**Путь к файлу приватного ключа сертификата панели**".

Так же в "**Домен прослушивания панели**" - вводим домен, который привязывался к серверу.

И для большей безопасности заполняем "**Корневой путь URL адреса панели**", желательно чем то в стиле `hjj2uDQoHwE27YhcJA5UP2LsmVYphd6U`. Важно, чтобы путь начинался с `/` и заканчивался так же на `/`.

Далее нажимаем "**Сохранить**" и "**Перезапуск панели**".

Теперь соединение должно стать защищенным (https), а url поменяться (если вы изменили "**Корневой путь URL адреса панели**").

Так же, то же самое, но используя другой путь стоит сделать во вкладках "**Подписка**" и "**Подписка JSON**"

{{< hint info >}}
На вкладке "**Подписка**" заполнять путь к ключам необязательно. А вот "**Домен прослушивания**" заполнить желательно.
{{< /hint >}}

Во вкладке "**Подписка**" очень желательно поменять "**Порт подписки**", на любой другой. Так же, от 2000 до 65000, и при этом чтобы он не совпадал с портом панели.

## Миграция

Если у вас есть ".db" и ".config".

Так же, восстанавливается все, не только ключи, но и настройки панели. Но все же, я бы рекомендовал для начала настроить домен и безопасность, а потом восстанавливать данные.

Нужно заменить эти файлы, для db в `/etc/x-ui/`.

Для конфига же, местоположение может быть разным, лучше всего сделать так:

```bash
sudo find / -name "config.json"
```

Чтобы найти местоположение этого файла. И его соотвественно тоже заменить.

В моем случае конфиг был в `/usr/local/x-ui/bin/`.

Далее нужно просто перезапустить панель.

## Решение проблем

Если что-то не работает, не подключается к ВПН, то вполне может помочь банальная перезагрузка сервера.

Если после обновления панель не стартует, то возможно поможет сброс пути панели через команду `x-ui`. Если до этого путь был, а во время сброса ничего не вводить в поле то путь сброшен НЕ БУДЕТ. Нужно дать панели сгенерировать рандомный путь. Войти в панель используя его, и через настройки поменять на тот путь на который вам нужно.

## Занавес

Некоторые ~~пид\*расы~~ провайдеры держат сервера в России, но прикручивают к ним зарубежные ip. IP у вас поменяется, но зайти на заблокированные сайты - вероятней всего не получится. К тому же они будут коллекционировать ваши логи, привет [закон яровой](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BA%D0%BE%D0%BD_%D0%AF%D1%80%D0%BE%D0%B2%D0%BE%D0%B9?nt).
